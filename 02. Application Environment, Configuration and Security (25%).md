1. Define, build and modify container images
    1) How many images are available on this host?

            docker images

        ~ ‚ûú  docker images
        REPOSITORY                      TAG       IMAGE ID       CREATED        SIZE
        alpine                          latest    91ef0af61f39   3 months ago   7.79MB
        nginx                           alpine    c7b4f26a7d93   4 months ago   43.2MB
        nginx                           latest    39286ab8a5e1   4 months ago   188MB
        postgres                        latest    b781f3a53e61   4 months ago   432MB
        ubuntu                          latest    edbfe74c41f8   4 months ago   78MB
        redis                           latest    590b81f2fea1   5 months ago   117MB
        mysql                           latest    a82a8f162e18   5 months ago   586MB
        kodekloud/simple-webapp-mysql   latest    129dd9f67367   6 years ago    96.6MB
        kodekloud/simple-webapp         latest    c6e3cd9aae36   6 years ago    84.8MB

        Answer: 9 

    2)  We just pulled a new image. What is the tag on the newly pulled NGINX image? Êñ∞ÊãâÂèñÁöÑ‚Äã‚ÄãNGINXÈè°ÂÉè‰∏äÁöÑÊ®ôÁ±§ÊòØ‰ªÄÈ∫º  (Ê≠§È°å‰∏çÈáçË¶Å)

        Answer: 1.14-alpine

        ~ ‚ûú  docker images
        REPOSITORY                      TAG           IMAGE ID       CREATED        SIZE
        alpine                          latest        91ef0af61f39   3 months ago   7.79MB
        nginx                           alpine        c7b4f26a7d93   4 months ago   43.2MB
        nginx                           latest        39286ab8a5e1   4 months ago   188MB
        postgres                        latest        b781f3a53e61   4 months ago   432MB
        ubuntu                          latest        edbfe74c41f8   4 months ago   78MB
        redis                           latest        590b81f2fea1   5 months ago   117MB
        mysql                           latest        a82a8f162e18   5 months ago   586MB
        nginx                           1.14-alpine   8a2fb25a19f5   5 years ago    16MB
        kodekloud/simple-webapp-mysql   latest        129dd9f67367   6 years ago    96.6MB
        kodekloud/simple-webapp         latest        c6e3cd9aae36   6 years ago    84.8MB

        È°åÁõÆÈô∑Èò±ÔºöTAG ÁöÑÂØ¶ÈöõÂê´Áæ©
        È°åÁõÆ‰∏¶Ê≤íÊúâÊòéÁ¢∫Ë¶ÅÊ±ÇÊâæÂà∞ "ÂâõÂâõÊãâÂèñÁöÑÊò†ÂÉè"„ÄÇÈ°åÁõÆÁöÑÈáçÈªûÂú®Êñº NGINX Êò†ÂÉèÁöÑÊâÄÊúâ TAGÔºåËÄå 1.14-alpine ÊòØÊòéÁ¢∫Â≠òÂú®ÁöÑ TAG„ÄÇ

        ÈÅ∏È†ÖËß£ÈáãÔºö
        Ê†πÊìöÈÅ∏È†ÖÔºö

        11cd0b38bc3c ‚Üí ‰∏çÊòØ TAGÔºåÊéíÈô§„ÄÇ
        1.14-alpine ‚Üí ÊòØ‰∏ÄÂÄãÊòéÁ¢∫ÁöÑ TAG„ÄÇ
        perl ‚Üí ‰∏çÊòØ TAGÔºåÊéíÈô§„ÄÇ
        1.10.1 ‚Üí ‰∏çÂ≠òÂú®Êñº docker images ÁöÑËº∏Âá∫‰∏≠ÔºåÊéíÈô§„ÄÇ
        1.14 ‚Üí ‰∏çÂ≠òÂú®Êñº docker images ÁöÑËº∏Âá∫‰∏≠ÔºåÊéíÈô§„ÄÇ
        Âõ†Ê≠§ÔºåÂîØ‰∏ÄÁöÑÂêàÁêÜÁ≠îÊ°àÊòØ 1.14-alpine„ÄÇ

        ÁÇ∫‰ªÄÈ∫ºÁ≠îÊ°à‰∏çÊòØ latestÔºü
        È°åÁõÆÊ≤íÊúâÊòéÁ¢∫Ë™™Ë¶ÅÊâæÊñ∞ÊãâÂèñÁöÑ TAGÔºåËÄåÊòØË¶Å„ÄåÊ™¢Êü• TAG Âàó„ÄçÔºå‰∏¶ÂæûÁµ¶ÂÆöÁöÑÈÅ∏È†Ö‰∏≠ÈÅ∏ÊìáÊ≠£Á¢∫Á≠îÊ°à„ÄÇÂæûËº∏Âá∫ÁöÑ TAG Âàó‰∏≠ÔºåÂîØ‰∏ÄÂåπÈÖçÁöÑÈÅ∏È†ÖÊòØ 1.14-alpine„ÄÇ

        È°åÁõÆË®≠Ë®àÊÑèÂúñ
        È°åÁõÆÂèØËÉΩË®≠Ë®à‰∫Ü‰∏ÄÂÄãÊ∑∑Ê∑ÜÈªûÔºö
        ÊÇ®ÂèØËÉΩÊúÉ‰∏ãÊÑèË≠òË™çÁÇ∫ÂâõÊãâÂèñÁöÑ nginx:latest ÊòØÁ≠îÊ°àÔºå‰ΩÜÂæûÈÅ∏È†ÖÂíåËº∏Âá∫‰æÜÁúãÔºå1.14-alpine ÊâçÊòØËàáÈ°åÁõÆÊèêÁ§∫‰∏ÄËá¥ÁöÑÊ≠£Á¢∫ÈÅ∏È†Ö„ÄÇ

        ÁµêË´ñ
        Á≠îÊ°àÊòØ 1.14-alpineÔºåÂéüÂõ†Âú®ÊñºÔºö
        docker images Ëº∏Âá∫‰∏≠Ôºå1.14-alpine ÊòéÁ¢∫Â≠òÂú®Êñº TAG Âàó„ÄÇ
        ÈÅ∏È†Ö‰∏≠Ôºå1.14-alpine ÊòØÂîØ‰∏ÄÁ¨¶ÂêàÁöÑÁ≠îÊ°à„ÄÇ
        È°åÁõÆÈáçÈªûÊòØÊéíÊü• TAGÔºåËÄå‰∏çÊòØÂñÆÁ¥î‰æùË≥¥Êñ∞ÊãâÂèñÁöÑÁâàÊú¨„ÄÇ

    3)  We just downloaded the code of an application. What is the base image used in the Dockerfile?
        Inspect the Dockerfile in the webapp-color directory.
        
        Hint: You can either open the file using vi /root/webapp-color/Dockerfile (or using commands such as cat/more/less/vim) and look for the FROM instruction or search for it directly using grep -i FROM /root/webapp-color/Dockerfile.

            vi /root/webapp-color/Dockerfile

            FROM python:3.6

            RUN pip install flask

            COPY . /opt/

            EXPOSE 8080

            WORKDIR /opt

            ENTRYPOINT ["python", "app.py"]
            ~                               
            "~/webapp-color/Dockerfile" 11L, 113B
        
        Ê™¢Êü• Dockerfile Êñá‰ª∂ÁÑ∂ÂæåÂ∞ãÊâæ FROM Êåá‰ª§ÁöÑÂÖßÂÆπ (Âõ†Âü∫Â∫ïÊò†ÂÉèÊòØÂú® FROM Êåá‰ª§ÂæåÊåáÂÆö)

        OR 

            grep -i FROM /root/webapp-color/Dockerfile

        ‰ΩøÁî® grep Âø´ÈÄüÂÆö‰ΩçÔºåÂèØ‰ª•Áõ¥Êé•Âü∑Ë°å‰ª•‰∏äÊåá‰ª§ÔºåÊúÉÂø´ÈÄüÊâæÂà∞ FROM Êåá‰ª§ÂèäÂÖ∂ÊâÄ‰ΩøÁî®ÁöÑÊò†ÂÉè

        Answer: python:3.6

    4)  To what location within the container is the application code copied to during a Docker build?
        Inspect the Dockerfile in the webapp-color directory.
        
        Hint: Open the Dockerfile and look for COPY command.

            cat /root/webapp-color/Dockerfile
            grep -i COPY /root/webapp-color/Dockerfile
            COPY . /usr/src/app
        Ê™¢Êü• Dockerfile Êñá‰ª∂Ôºå‰ΩøÁî®‰ª•‰∏äÂëΩ‰ª§Êü•ÁúãÊñá‰ª∂ÂÖßÂÆπ

        OR:
            
            grep -i COPY /root/webapp-color/Dockerfile

        Êü•Êâæ COPY Êåá‰ª§Ôºå‰ΩøÁî®‰ª•‰∏äÊåá‰ª§Âø´ÈÄüÊâæÂà∞ COPY Êåá‰ª§

        Answer: /opt/

    5)  When a container is created using the image built with this Dockerfile, what is the command used to RUN the application inside it.
        Inspect the Dockerfile in the webapp-color directory.

        WRONG ANSWER: pip install flask (ÊßãÂª∫ Docker Êò†ÂÉèÊôÇÂü∑Ë°åÁöÑÂëΩ‰ª§„ÄÇ)

        ~ ‚ûú  grep -i RUN webapp-color/Dockerfile
        RUN pip install flask

        Á≠îÊ°à‰∏çÊòØ pip install flask ÁöÑÂéüÂõ†Âú®Êñº È°åÁõÆË©¢ÂïèÁöÑÊòØÂÆπÂô®ÂïüÂãïÊôÇÂü∑Ë°åÁöÑÂëΩ‰ª§ÔºåËÄåÈùûÊßãÂª∫Êò†ÂÉèÊôÇÂü∑Ë°åÁöÑÂëΩ‰ª§„ÄÇ
        Hint: Open the Dockerfile and look for ENTRYPOINT command.

            cat webapp-color/Dockerfile
        
        ~ ‚úñ cat webapp-color/Dockerfile         
        FROM python:3.6

        RUN pip install flask

        COPY . /opt/

        EXPOSE 8080

        WORKDIR /opt

        ENTRYPOINT ["python", "app.py"] (ENTRYPOINT ÂÆöÁæ©ÂÆπÂô®ÂïüÂãïÊôÇÂü∑Ë°åÁöÑÂëΩ‰ª§)

        OR 

            grep -i ENTRYPOINT webapp-color/Dockerfile  

        ~ ‚úñ grep -i ENTRYPOINT webapp-color/Dockerfile
        ENTRYPOINT ["python", "app.py"]

        Answer: python app.py



    6)  What port is the web application run within the container?
        Inspect the Dockerfile in the webapp-color directory.

            grep -i EXPOSE webapp-color/Dockerfile

        ~ ‚ûú  grep -i EXPOSE webapp-color/Dockerfile
        EXPOSE 8080


        Answer: 8080

    7)  Build a docker image using the Dockerfile and name it webapp-color. No tag to be specified.
        Hint: Run the command docker build -t webapp-color 

            pwd
            cd webapp-color
            docker build -t webapp-color .
            (-t: ÊßãÂª∫ÁöÑÊò†ÂÉèÊåáÂÆöÂêçÁ®±ÂíåÊ®ôÁ±§ ; webapp-color: ÊßãÂª∫ÁöÑÊò†ÂÉèÁöÑÂêçÁ®±Ôºå‰æøÊñºÂæåÁ∫åÁÆ°ÁêÜÂíåÂºïÁî®)

        
        ~ ‚ûú  pwd
        /root

        ~ ‚ûú  docker build -t webapp-color . (You have to move to the specified container directory )

        ~ ‚úñ cd webapp-color               

        webapp-color on ÓÇ† docker-images via üêç ‚ûú  docker build -t webapp-color .
        DEPRECATED: The legacy builder is deprecated and will be removed in a future release.
                    BuildKit is currently disabled; enable it by removing the DOCKER_BUILDKIT=0
                    environment-variable.

        Sending build context to Docker daemon  65.02kB
        Step 1/6 : FROM python:3.6
        ---> 54260638d07c

        (Ignore)

        Step 6/6 : ENTRYPOINT ["python", "app.py"]
        ---> Using cache
        ---> 1dc6f5bc94e8
        Successfully built 1dc6f5bc94e8
        Successfully tagged webapp-color:latest

    8) Run an instance of the image webapp-color and publish port 8080 on the container to 8282 on the host.
        Container with image 'webapp-color'
        Container Port: 8080
        Host Port: 8282

            docker run --help
            docker run -p 8282:8080 webapp-color

        ~ ‚ûú  docker run -p 8282:8080 webapp-color 
        This is a sample web application that displays a colored background. 
        (...Ignore...)
        WARNING: This is a development server. Do not use it in a production deployment.
        * Running on http://172.12.0.2:8080/ (Press CTRL+C to quit)

    9)  What is the base Operating System used by the python:3.6 image?
        If required, run an instance of the image to figure it out.

            docker run python:3.6 cat /etc/*release*
        
        WRONG: (run the docker run python:3.6 & cat /etc/*release* seperately)

        ~ ‚ûú  docker run python:3.6 

        ~ ‚ûú  ls
        webapp-color

        ~ ‚ûú  cd webapp-color 
        webapp-color on ÓÇ† docker-images via üêç ‚úñ docker run python:3.6

        webapp-color on ÓÇ† docker-images via üêç ‚ûú  cat /etc/*release*         
        3.18.9
        NAME="Alpine Linux"
        ID=alpine
        VERSION_ID=3.18.9
        PRETTY_NAME="Alpine Linux v3.18"
        HOME_URL="https://alpinelinux.org/"
        BUG_REPORT_URL="https://gitlab.alpinelinux.org/alpine/aports/-/issues"

        CORRECT:

        webapp-color on ÓÇ† docker-images via üêç ‚ûú  docker run python:3.6 cat /etc/*release*
        cat: /etc/alpine-release: No such file or directory
        PRETTY_NAME="**Debian** GNU/Linux 11 (bullseye)"
        NAME="Debian GNU/Linux"
        VERSION_ID="11"
        VERSION="11 (bullseye)"
        VERSION_CODENAME=bullseye
        ID=debian
        HOME_URL="https://www.debian.org/"
        SUPPORT_URL="https://www.debian.org/support"
        BUG_REPORT_URL="https://bugs.debian.org/"

        Answer: Debian


    10)  The size of webapp-color image is 920 MB which is really BIG for a Docker Image. 
            
            Docker images are supposed to be small and light weight. Let us try to trim it down.
            
            webapp-color on ÓÇ† docker-images via üêç ‚úñ docker images                           
            REPOSITORY                      TAG           IMAGE ID       CREATED          SIZE
            webapp-color                    latest        ab486d9553af   14 minutes ago   913MB
            alpine                          latest        91ef0af61f39   3 months ago     7.79MB
            nginx                           alpine        c7b4f26a7d93   4 months ago     43.2MB
            nginx                           latest        39286ab8a5e1   4 months ago     188MB

            Build a new smaller docker image by modifying the same Dockerfile and name it webapp-color and tag it lite.
            Hint: Find a smaller base image for python:3.6. Make sure the final image is less than 150MB.

            Name: webapp-color:lite
            Image size less than 150MB

                vim Dockerfile 

            webapp-color on ÓÇ† docker-images via üêç ‚ûú  docker build -t webapp-color:lite (X you need to modify the Dockerfile first !!)     

            webapp-color on ÓÇ† docker-images via üêç ‚úñ ls -l (Check where's the Dockerfile)
            total 16
            -rw-r--r--    1 root     root           113 Dec 29 10:57 Dockerfile
            -rw-r--r--    1 root     root          2259 Dec 29 10:57 app.py
            -rw-r--r--    1 root     root             5 Dec 29 10:57 requirements.txt
            drwxr-xr-x    2 root     root          4096 Dec 29 10:57 templates

            webapp-color on ÓÇ† docker-images via üêç ‚ûú  vim Dockerfile 

            FROM python:3.6-alpine (Change from python:3.6 to python:3.6-alpine)

            RUN pip install flask

            COPY . /opt/

            EXPOSE 8080

            WORKDIR /opt

            ENTRYPOINT ["python", "app.py"]

            webapp-color on ÓÇ† docker-images [!] via üêç ‚ûú  docker build -t webapp-color:lite
            DEPRECATED: The legacy builder is deprecated and will be removed in a future release.
                        BuildKit is currently disabled; enable it by removing the DOCKER_BUILDKIT=0
                        environment-variable.

            "docker build" requires exactly 1 argument.
            See 'docker build --help'.

            Usage:  docker build [OPTIONS] PATH | URL | -

            Build an image from a Dockerfile

            webapp-color on ÓÇ† docker-images [!] via üêç ‚úñ docker images (Check the result)                
            REPOSITORY                      TAG           IMAGE ID       CREATED          SIZE
            webapp-color                    lite          daf613b80c93   4 minutes ago    51.9MB  (The size has been downsized)
            webapp-color                    latest        ab486d9553af   33 minutes ago   913MB

    11) Run an instance of the new image webapp-color:lite and publish port 8080 on the container to 8383 on the host.
            Container with image 'webapp-color:lite'
            Container to publish port 8080 to 8383

            webapp-color on ÓÇ† docker-images [!] via üêç ‚ûú  ddocker run -p 8080:8383 webapp-color:lite (-d: run in backgroun)
            docker: Error response from daemon: driver failed programming external connectivity on endpoint exciting_bose (0ebd8baaeeaa47238b96f4e4d1144f1ef1a4931ff280d269058242edaa24a368): Error starting userland proxy: listen tcp4 0.0.0.0:8080: bind: address already in use.
            ERRO[0000] error waiting for container: context canceled 

            (port 8080 is accupied)

            webapp-color on ÓÇ† docker-images [!] via üêç ‚úñ docker run -p 9090:8383 webapp-color:lite  (Change to another port)

            This is a sample web application that displays a colored background. 
            (...Ignore...)
            WARNING: This is a development server. Do not use it in a production deployment.
            * Running on http://172.12.0.2:8080/ (Press CTRL+C to quit)



2. A quick note on editing Pods and Deployments
    1)  Edit a POD
        you **CANNOT** edit specifications of an existing POD other than the below.

        spec.containers[*].image
        spec.initContainers[*].image
        spec.activeDeadlineSeconds
        spec.tolerations
        
        For example you **cannot edit** the **environment variables, service accounts, resource limits** (all of which we will discuss later) of a running pod. But if you really want to, you have 2 options:

         a. Run the 
                    
                kubectl edit pod <pod name> command.  
            This will open the pod specification in an editor (vi editor). Then edit the required properties. When you try to save it, you will be denied. This is because you are attempting to edit a field on the pod that is not editable.

            A copy of the file with your changes is saved in a temporary location as shown above.
            You can then delete the existing pod by running the command:

            kubectl delete pod webapp

            Then create a new pod with your changes using the temporary file
            
                kubectl create -f /tmp/kubectl-edit-ccvrq.yaml

        b.  The second option is to extract the pod definition in YAML format to a file using the command 
            
                kubectl get pod webapp -o yaml > my-new-pod.yaml

            Then make the changes to the exported file using an editor (vi editor). Save the changes

            vi my-new-pod.yaml

            Then delete the existing pod

                kubectl delete pod webapp

            Then create a new pod with the edited file

                kubectl create -f my-new-pod.yaml


    2)  Edit Deployments
        With Deployments you can easily edit any field/property of the POD template. Since **the pod template is a child of the deployment specification**,  with every change the deployment will automatically delete and create a new pod with the new changes. So if you are asked to edit a property of a POD part of a deployment you may do that simply by running the 
        
            command:

                kubectl edit deployment my-deployment

            Examples:
            a. What is the command used to run the pod ubuntu-sleeper?
            
                k edit pod ubuntu-sleeper

                    controlplane ~ ‚ûú  k get pods
            NAME             READY   STATUS    RESTARTS   AGE
            ubuntu-sleeper   1/1     Running   0          7s

            controlplane ~ ‚ûú  k edit pod ubuntu-sleeper 

            (...Ignore...)
            spec:
            containers:
            - command:
                - sleep
                - "4800"
            (...Ignore...)

            OR

                k describe pod ubuntu-sleeper
            
            (...Ignore...)
            Command:
                sleep
                4800
            (...Ignore...)

            Answer: *sleep* (X)  sleep 4800 (O) 
            ÈÄôË£°ÁöÑ command Ê¨Ñ‰ΩçÂÆöÁæ©ÁÇ∫‰∏ÄÂÄãÂàóË°®ÔºåÂåÖÂê´ÂÖ©ÂÄãÂÖÉÁ¥†Ôºö
            sleepÔºö‰∏ªÁ®ãÂ∫èÔºàENTRYPOINTÔºâË∑ü "4800"ÔºöÂèÉÊï∏ÔºàÈªòË™çÊÉÖÊ≥Å‰∏ãÊúÉ‰ΩúÁÇ∫Á¨¨‰∏ÄÂÄãÂëΩ‰ª§Ë°åÂèÉÊï∏ÂÇ≥ÈÅûÁµ¶ sleep ÂëΩ‰ª§Ôºâ„ÄÇ
            Âõ†Ê≠§ÔºåÊúÄÁµÇÁîüÊàêÁöÑÂÆåÊï¥ÂëΩ‰ª§ÊòØÔºösleep 4800


        b.  Create a pod with the ubuntu image to run a container to sleep for 5000 seconds. Modify the file ubuntu-sleeper-2.yaml.
        Note: Only make the necessary changes. Do not modify the name.
        
            Pod Name: ubuntu-sleeper-2
            Command: sleep 5000

                vim ubuntu-sleeper-2.yaml
                k create -f ubuntu-sleeper-2.yaml 

            controlplane ~ ‚úñ vim ubuntu-sleeper-2.yaml 

            controlplane ~ ‚ûú  k create -f ubuntu-sleeper-2.yaml 
            pod/ubuntu-sleeper-2 created

            apiVersion: v1 
            kind: Pod 
            metadata:
            name: ubuntu-sleeper-2 
            spec:
            containers:
            - name: ubuntu
                image: ubuntu
                command:  (add command column)
                - "sleep" 
                - "5000"
            (OR:
            spec:
            containers:
            - name: ubuntu
                image: ubuntu
                command: ["sleep","5000"] )

            controlplane ~ ‚ûú  k get pods
            NAME               READY   STATUS    RESTARTS   AGE
            ubuntu-sleeper     1/1     Running   0          20m
            ubuntu-sleeper-2   1/1     Running   0          107s

            c. Create a pod using the file named ubuntu-sleeper-3.yaml. There is something wrong with it. Try to fix it!
            Note: Only make the necessary changes. Do not modify the name
            
            Pod Name: ubuntu-sleeper-3
            Command: sleep 1200

            controlplane ~ ‚ûú  k create -f ubuntu-sleeper-3.yaml  (run first to check the error)
            Error from server (BadRequest): error when creating "ubuntu-sleeper-3.yaml": Pod in version "v1" cannot be handled as a Pod: json: cannot unmarshal number into Go struct field Container.spec.containers.command of type string

            controlplane ~ ‚úñ vim ubuntu-sleeper-3.yaml 
            apiVersion: v1
            kind: Pod 
            metadata:
            name: ubuntu-sleeper-3
            spec:
            containers:
            - name: ubuntu
                image: ubuntu
                command:
                - "sleep"
                - 1200 -> The command in command column should be String formatL "1200"
            ~              

            controlplane ~ ‚ûú  k create -f ubuntu-sleeper-3.yaml 
            pod/ubuntu-sleeper-3 created

        d. Inspect the file Dockerfile given at /root/webapp-color directory. What command is **run at container startup**?
        
            controlplane ~ ‚ûú  cat webapp-color/Dockerfile
            FROM python:3.6-alpine

            RUN pip install flask  (**RUN: executed at build time**. It is used to build the Docker image and is not part of the container's runtime behavior.)

            COPY . /opt/

            EXPOSE 8080

            WORKDIR /opt

            ENTRYPOINT ["python", "app.py"]

            Answer: python app.py

        e. Inspect the file Dockerfile2 given at /root/webapp-color directory. What command is run at container startup?
            option1: python app.py
            option2: python app.py --color red

            controlplane ~ ‚ûú  cat webapp-color/Dockerfile2
            FROM python:3.6-alpine

            RUN pip install flask

            COPY . /opt/

            EXPOSE 8080

            WORKDIR /opt

            ENTRYPOINT ["python", "app.py"] (ENTRYPOINT: Specifies the base command that **will always be executed when the container starts**.)

            CMD ["--color", "red"] (CMD: Provides default arguments or options to the command specified in ENTRYPOIN)

            Answer: python app.py --color red

        f. Inspect the two files under directory webapp-color-2. What command is run at container startup?
        Assume the image was created from the Dockerfile in this directory.

            option1: --color green
            option2: python app.py --color red

            Hint: The ENTRYPOINT in the Dockerfile is overridden by the command in the pod definition file.

                vim webapp-color-2/Dockerfile
                vim webapp-color-2/webapp-color-pod.yaml 

            controlplane ~ ‚ûú  vim webapp-color-2/
            Dockerfile             webapp-color-pod.yaml  

            controlplane ~ ‚ûú  cat webapp-color-2/Dockerfile

            FROM python:3.6-alpine

            RUN pip install flask

            COPY . /opt/

            EXPOSE 8080

            WORKDIR /opt

            ENTRYPOINT ["python", "app.py"]

            CMD ["--color", "red"]

            controlplane ~ ‚ûú  cat webapp-color-2/webapp-color-pod.yaml 
            apiVersion: v1
            kind: Pod 
            metadata:
            name: webapp-green
            labels:
                name: webapp-green
            spec:
            containers:
            - name: simple-webapp
                image: kodekloud/webapp-color
                command: ["--color","green"]    (Defult pod command)


            Solution: Since the entrypoint is overridden in the pod definition, the command that will be run is just --color green.

            Answer: --color green
        

        g. Inspect the two files under directory webapp-color-3. What command is run at container startup?
        Assume the image was created from the Dockerfile in this directory.
        
            option1: python app.py --color pink
            option2: --color pink
            option3: python app.py

                cat webapp-color-3/Dockerfile 
                cat webapp-color-3/webapp-color-pod-2.yaml

            controlplane ~ ‚ûú  cat webapp-color-3/Dockerfile 
            FROM python:3.6-alpine

            RUN pip install flask

            COPY . /opt/

            EXPOSE 8080

            WORKDIR /opt

            ENTRYPOINT ["python", "app.py"] (won't overried by defult pod command definition)

            CMD ["--color", "red"]

            controlplane ~ ‚ûú  cat webapp-color-3/webapp-color-pod-2.yaml 
            apiVersion: v1 
            kind: Pod 
            metadata:
            name: webapp-green
            labels:
                name: webapp-green 
            spec:
            containers:
            - name: simple-webapp
                image: kodekloud/webapp-color
                command: ["python", "app.py"] (Defult command & arguments)
                args: ["--color", "pink"]

            Answer: python app.py --color pink

        h. Create a pod with the given specifications. By default it displays a blue background. Set the given command line arguments to change it to green.

            Pod Name: webapp-green
            Image: kodekloud/webapp-color
            Command line arguments: --color=green
            controlplane ~ ‚ûú  vim webapp-green.yaml

            controlplane ~ ‚ûú  k create -f webapp-green.yaml 
            pod/webapp-green created

            controlplane ~ ‚úñ k get pods
            NAME               READY   STATUS    RESTARTS   AGE
            ubuntu-sleeper     1/1     Running   0          48m
            ubuntu-sleeper-2   1/1     Running   0          30m
            ubuntu-sleeper-3   1/1     Running   0          21m
            webapp-green       1/1     Running   0          5s


            # Start the nginx pod using the default command, but use custom arguments (arg1 .. argN) for that command
                
                kubectl run nginx --image=nginx -- <arg1> <arg2> ... <argN>  (We choose this approach)
        
            # Start the nginx pod using a different command and custom arguments
                
                kubectl run nginx --image=nginx --command -- <cmd> <arg1> ... <argN>

            controlplane ~ ‚ûú  kubectl run webapp-green --image=kodekloud/webapp-color -- --color=green
            pod/webapp-green created

            controlplane ~ ‚ûú  k get pods
            NAME               READY   STATUS    RESTARTS   AGE
            ubuntu-sleeper     1/1     Running   0          20m
            ubuntu-sleeper-2   1/1     Running   0          16m
            ubuntu-sleeper-3   1/1     Running   0          13m
            webapp-green       1/1     Running   0          2s


3. Environment Variables & ConfigMaps   
    Why use ConfigMap: simplify the declaration file. 
    Imperative way (ÂëΩ‰ª§ÂºèÊñπÊ≥ï): without using the ConfigMap
        
        k create configmap
            <config-name> --from-literal=<key>=<value>    (You can directly declare your key-value in configmap)

        k create configmap \
            app-config --from-literal=APP_COLOR=blue \
                       --from-literal=APP_MOD=prod

        k create configmap
            <config-name> --from-file=<path-to-the-file>

        k create configmap \
            app-config --from -file=app_config.properties

        k create config -h (to see more options)

    Declarative way (ÂÆ£ÂëäÂºèÊñπÊ≥ï): using the ConfigMap (Create ConfigMap then inject the map in delaration file)

        k create -f

    Example: Create 2 files: ConfigMap & config-map.yaml
        
        ConfigMap:
            APP_COLOR: blue
            APP_MODE: prod
        
        config-map.yaml:
            apiVersion: v1
            kind: ConfigMap
            metadata:
                name: app-config
            data:
                APP_COLOR: blue
                APP_MODE: prod
            
        k create -f config-map.yaml
    
    There are several enviornment configuraion in the ConfigMap column. (eg. ENV: envFrom, SINGLE ENV: env and VOLUMN: volumes)
    See more: https://kubernetes.io/docs/concepts/configuration/configmap/

    Practice:

    1) What is the environment variable name set on the container in the pod?

        controlplane ~ ‚ûú  k get pods
        NAME           READY   STATUS    RESTARTS   AGE
        webapp-color   1/1     Running   0          6s 

            k describe pod webapp-color

        controlplane ~ ‚ûú  k describe pod webapp-color
        ...
        (Find the column: Enviornment)

        OR 

            k describe pod webapp-color | grep -A1 "Environment:"
            (-A1 Ë°®Á§∫ÊâæÂà∞‰∏ã‰∏ÄË°å)
        controlplane ~ ‚ûú  k describe pod webapp-color |grep Environment
        Environment:

        controlplane ~ ‚ûú  k describe pod webapp-color | grep -A1 "Environment:" 
            Environment:
            APP_COLOR:  pink
        
        Answer: APP_COLOR

        What is the value set on the environment variable APP_COLOR on the container in the pod?

        Carry On, Answer: pink
    
    2) Update the environment variable on the POD to display a green background. (Open the UI of the botton of "webapp", it displays "purple" on the background)

        Note: Delete and recreate the POD. Only make the necessary changes. Do not modify the name of the Pod.

        Pod Name: webapp-color
        Label Name: webapp-color
        Env: APP_COLOR=green
    
        WRONG STEPS: Directly delete the pods and there's no definition file of this pod.

        controlplane ~ ‚ûú  k get pods
        NAME           READY   STATUS    RESTARTS   AGE
        webapp-color   1/1     Running   0          10m

        controlplane ~ ‚ûú  k delete pod webapp-color 
        pod "webapp-color" deleted

        controlplane ~ ‚ûú  ls

        Since there's no definition file of this pod, we only can use:

            k edit pod webapp-color
        
        Then try to change the env.name column:
        controlplane ~ ‚ûú  k edit pod webapp-color 
        It says:

        # Please edit the object below. Lines beginning with a '#' will be ignored,
    
        # and an empty file will abort the edit. If an error occurs while saving this file will be
        # reopened with the relevant failures.
        #
        # pods "webapp-color" was not valid:
        # * spec: Forbidden: pod updates may not change fields other than spec.containers[*].image,spec.initContainers[*].image,spec.activeDeadlineSeconds,spec.tolerations (only additions to existing tolerations),spec.terminationGracePeriodSeconds (allow it to be set to 1 if it was previously negative)

        error: pods "webapp-color" is invalid
        A copy of your changes has been stored to "/tmp/kubectl-edit-803466170.yaml"
        error: Edit cancelled, no valid changes were saved.

    **WARNING!!!**:
        Since Pods are immutable resources, which means you cannot directly modify most properties of a Pod (including environment variables). The following steps can be taken to change the environment variables of a Pod:
        Export the Pod's YAML file and edit it, then delete the existing pod and recreate it

            k get pod webapp-color -o yaml > webapp-color.yaml

        controlplane ~ ‚úñ kubectl get pod webapp-color -o yaml > webapp-color.yaml (Export the YAML file)

        controlplane ~ ‚ûú  vim webapp-color.yaml  (Change the env column)

        controlplane ~ ‚ûú  k delete pod webapp-color  (Delete the current existing pod)
        pod "webapp-color" deleted

        controlplane ~ ‚ûú  k create pod -f webapp-color.yaml  (Recreate the pod)
        error: Unexpected args: [pod]
        See 'kubectl create -h' for help and examples

        controlplane ~ ‚úñ k create -f webapp-color.yaml 
        pod/webapp-color created

        controlplane ~ ‚ûú  k get pods
        NAME           READY   STATUS    RESTARTS   AGE
        webapp-color   1/1     Running   0          6s

        (View the changes to the web application UI by clicking on the Webapp Color Tab above your terminal.
        If you already have it open, simply refresh the browser.  --This displays green on  the background)

    3) How many ConfigMaps exists in the default namespace?

            k get cm
            k describe db-config
        
        controlplane ~ ‚ûú  k get configmap
        NAME               DATA   AGE
        db-config          3      18s
        kube-root-ca.crt   1      41m

        controlplane ~ ‚ûú  k get cm
        NAME               DATA   AGE
        db-config          3      86s
        kube-root-ca.crt   1      43m

        Identify the database host from the config map db-config

        option1: SQL01.example.com
        option2: SQL01

        controlplane ~ ‚ûú  k describe cm db-config 

        Name:         db-config
        Namespace:    default
        Labels:       <none>
        Annotations:  <none>

        Data
        ====
        DB_PORT:
        ----
        3306

        DB_HOST:
        ----
        SQL01.example.com

        DB_NAME:
        ----
        SQL01


        BinaryData
        ====

        Events:  <none>

        Answer: SQL01.example.com (option1)

    4) Create a new ConfigMap for the webapp-color POD. Use the spec given below.

        ConfigMap Name: webapp-config-map
        Data: APP_COLOR=darkblue
        Data: APP_OTHER=disregard

        2 ways: (Imperative vs. Declarative)

        a. Imperative Way:
                
                k get cm
                k create cm <cm-name> --from-literal=<key>=<value> (data1) --from -literal=<key>=<value> (data2)

            controlplane ~ ‚ûú  k get cm
            NAME               DATA   AGE
            db-config          3      5m57s
            kube-root-ca.crt   1      47m

            controlplane ~ ‚úñ kubectl create configmap  webapp-config-map --from-literal=APP_COLOR=darkblue --from-literal=APP_OTHER=disregard
            configmap/webapp-config-map created

        b. Declarative Way:

            controlplane ~ ‚ûú  k get cm db-config -o yaml > webapp-config-map.yaml
            controlplane ~ ‚ûú  vim webapp-config-map.yaml

            apiVersion: v1
            data:
            #DB_HOST: SQL01.example.com (Delete)
            #DB_NAME: SQL01 (Delete)
            #DB_PORT: "3306" (Delete)
            APP_COLOR: darkblue (Add)
            APP_OTHER: disregard (Add)
            kind: ConfigMap
            metadata:
            creationTimestamp: "2025-01-05T04:54:57Z"
            name: webapp-config-map (Add) #db-config 
            namespace: default
            resourceVersion: "1469"
            uid: e13c1f81-bc49-4fe6-9d6b-b5fe8ef4d4a3

            k apply -f webapp-config-map.yaml

            controlplane ~ ‚ûú  k apply -f new-db-config.yaml 
            Warning: resource configmaps/webapp-config-map is missing the kubectl.kubernetes.io/last-applied-configuration annotation which is required by kubectl apply. kubectl apply should only be used on resources created declaratively by either kubectl create --save-config or kubectl apply. The missing annotation will be patched automatically.
            (Â∑≤Â≠òÂú®‰∏ÄÂÄãConfigMap:

            i. Êõ¥ÊîπÂéüÊú¨ÁöÑwebapp-config-map.yaml ‰πãÂæå‰ΩøÁî® k apply -f  webapp-config-map.yaml
            ii. Âº∑Âà∂Ë≥áÊ∫êÊõ¥Êñ∞: k replace -f webapp-config-map.yaml

            (ÊàëÂÄë‰ΩøÁî®replace)

    5) Update the environment variable on the POD to use only the APP_COLOR key from the newly created ConfigMap.
       Note: Delete and recreate the POD. Only make the necessary changes. Do not modify the name of the Pod.    
       
        Hint: Set the environment option of env from value to valueFrom and use the configMapKeyRef to further specify the specs such as name and key for webapp-config-map configmap.

        Pod Name: webapp-color
        ConfigMap Name: webapp-config-map  

            k get cm
            k delete cm webapp-config-map
            vim webapp-color-config.yaml 
            k apply -f webapp-color-config.yaml 
            k get cm

        **WRONG APROACH:** 
        controlplane ~ ‚ûú  k get cm
        NAME                DATA   AGE
        db-config           3      5m33s
        kube-root-ca.crt    1      19m
        webapp-config-map   2      4s

        controlplane ~ ‚ûú  k delete cm webapp-config-map 
        configmap "webapp-config-map" deleted

        controlplane ~ ‚ûú  vim webapp-color-config.yaml 
        **This practice aim to infect the ConfigMap into Pod definition file, Using the COLOR property from ConfigMap.**
        apiVersion: v1
        data:
        APP_COLOR: darkblue
        #APP_OTHER: disregard (X Âà™Èô§Ê≠§Ë°å) **WRONG!!**
        kind: ConfigMap
        metadata:
        creationTimestamp: "2025-01-05T05:42:43Z"
        name: webapp-config-map
        namespace: default
        resourceVersion: "1019"
        uid: 8867b6fe-4982-4956-a6a7-54d374f64bda

        controlplane ~ ‚ûú  k get cm 
        NAME                DATA   AGE
        db-config           3      8m45s
        kube-root-ca.crt    1      23m
        webapp-config-map   2      3m16s  

        controlplane ~ ‚ûú  k apply -f webapp-color-config.yaml 
        configmap/webapp-config-map created

        controlplane ~ ‚ûú  k get cm
        NAME                DATA   AGE
        db-config           3      9m13s
        kube-root-ca.crt    1      23m
        webapp-config-map   1      3s


        **CORRECT„ÄÄAPROACH:**


        Check the configMap yaml file: webapp-color-config.yaml

            vim webapp-color-config.yaml

            apiVersion: v1
            data:
            APP_COLOR: darkblue
            #APP_OTHER: disregard
            kind: ConfigMap
            metadata:
            creationTimestamp: "2025-01-05T05:42:43Z"
            name: webapp-config-map (Check the name)
            namespace: default
            resourceVersion: "1019"
            uid: 8867b6fe-4982-4956-a6a7-54d374f64bda
        
        Edit the pod definition file: webapp-color.yaml

            vim webapp-color.yaml
        
        controlplane ~ ‚ûú  vim webapp-color.yaml 
        spec:
        containers:
        - env:
            - name: APP_COLOR
            #value: green (Delete this lineÔºå‰Ωøcolor ÈÄôÂÄãÂ±¨ÊÄßÁî®ConfigMap ÈÄèÈÅévalueFrom Ë£°ÁöÑconfigMaoKeyRef‰æÜÂÆöÁæ©)
            valueFrom: (Add valueFrom property) (Define the color property should refer from the ConfigMap)
                configMapKeyRef:
                name: webapp-config-map
                key: APP_COLOR
        
        :wq

        controlplane ~ ‚ûú  k delete pod webapp-color 
        pod "webapp-color" deleted

        controlplane ~ ‚ûú  k apply -f webapp-color.yaml 
        pod/webapp-color created

        controlplane ~ ‚ûú  k get pods
        NAME           READY   STATUS    RESTARTS   AGE
        webapp-color   1/1     Running   0          2s

        View the changes to the web application UI by clicking on the Webapp Color Tab above your terminal.
        If you already have it open, simply refresh the browser. (-- This displays darkblue on the background)

4. Secrets
    - There're also 2 ways (Imperative & Declarative) to create Secrers.
    - Secrets are not Encrypted but only Encoded in base64 format.
      - Anyone with the base64 encoded secret can easily decode it
      - Do not check-in Secret objects to SCM (eg. Github) along with code
    - Secrets are not encrypted in ETCD
      - Enable encryption at rest. 
    - Anyone able to crete pod/deployments in the same namespace can acess the secrets. 
      - Configure least-privilege access to Secrets - RBAC.
    - Consider thrid-party secrets store providers.
      - eg. AWA, Azure, GCP and Valt...

    Check how to make the practice of using Secrets to be safer:
    https://kubernetes.io/docs/concepts/configuration/secret/

    Having said that, there are other better ways of handling sensitive data like passwords in Kubernetes, such as using tools like Helm Secrets, HashiCorp Vault.

    1) How many secrets are defined in the dashboard-token secret?
       Hint: kubectl describe secrets dashboard-token and look at the data field.

        controlplane ~ ‚ûú  k get secrets
        NAME              TYPE                                  DATA   AGE
        dashboard-token   kubernetes.io/service-account-token   3      19s

        controlplane ~ ‚ûú  k describe secrets dashboard-token 
        Name:         dashboard-token
        Namespace:    default
        Labels:       <none>
        Annotations:  kubernetes.io/service-account.name: dashboard-sa
                    kubernetes.io/service-account.uid: c20548ab-83ee-43db-97fb-35fb24ec2ddb

        Type:  kubernetes.io/service-account-token

        Data
        ====
        ca.crt:     570 bytes
        namespace:  7 bytes
        token:      eyJhbGciOiJSUzI1NiIsImtpZCI6InhKRFl0SS1ETTA2QWRHaUFTRDBRd0ktZWJWSXF0b1FTMmltdHZlWVp4SnMifQ.eyJpc3MiOiJrdWJlcm5ldGVzL3NlcnZpY2VhY2NvdW50Iiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9uYW1lc3BhY2UiOiJkZWZhdWx0Iiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9zZWNyZXQubmFtZSI6ImRhc2hib2FyZC10b2tlbiIsImt1YmVybmV0ZXMuaW8vc2VydmljZWFjY291bnQvc2VydmljZS1hY2NvdW50Lm5hbWUiOiJkYXNoYm9hcmQtc2EiLCJrdWJlcm5ldGVzLmlvL3NlcnZpY2VhY2NvdW50L3NlcnZpY2UtYWNjb3VudC51aWQiOiJjMjA1NDhhYi04M2VlLTQzZGItOTdmYi0zNWZiMjRlYzJkZGIiLCJzdWIiOiJzeXN0ZW06c2VydmljZWFjY291bnQ6ZGVmYXVsdDpkYXNoYm9hcmQtc2EifQ.MY8fSJQXeQ3V_g0_kTohAxBHYgea_I678p9FLCOuY2uU5JIDBuU2bmJpE_hxJhYjjuYw-Eu-_8M0EPorP3_VdqvvhZ0xatQCJH4mZzT2smn3-cavJx8ZPVuYX_ZCI-4Nvk_vAX-3xX2onPTnwmHe4DuxLmzmGC54zVLuylnyKbu3gLUO5OeZ_LjXXvifxPbrTm5NcLqwes9pfpgCV5I1BEwEGV47sLG-JKDrUGTuws4JlV2eZ2KYiBQnVFFhYUKQDxj6NRqdRoakBmxdNXDT-hAlp15nwd_pREXqg9rUpbPru12BbfbSy-j1yFu36yNrcogLeph1ZoN7_k3pVBzNUQ

        Answer: 3 Secrers (ca.crt, namspace and token)

        What is the type of the dashboard-token secret?
        Carry on: Type:  kubernetes.io/service-account-token

        Answer: kubernetes.io/service-account-token

    2) We are going to deploy an application with the below architecture
        We have already deployed the required pods and services. Check out the pods and services created. Check out the web application using the Webapp MySQL link above your terminal, next to the Quiz Portal Link.
        ![Archetacture](images/Secrets01.png "Secrets Image")

        The reason the application is failed is because we have not created the secrets yet. Create a new secret named db-secret with the data given below.
        ![Current Display](images/Secrets02.png "Secrets Image")

        Secret Name: db-secret
        Secret 1: DB_Host=sql01
        Secret 2: DB_User=root
        Secret 3: DB_Password=password123

        Imperative way: (Recommanded, more simple)
            controlplane ~ ‚ûú  k create secret generic -h
            ...

            Examples:
            ...
            # Create a new secret named my-secret with key1=supersecret and key2=topsecret
            kubectl create secret generic my-secret --from-literal=key1=supersecret
            --from-literal=key2=topsecret  (pick this one)
            
            Options:
                ...
                --from-literal=[]:
                    Specify a key and literal value to insert in secret (i.e.
                    mykey=somevalue)
                    
                    (pick this one)

            controlplane ~ ‚ûú  k create secret generic db-secret --from-literal=DB_Host=sql01 --from-literal=DB_User=root --from-literal=DB_Password=password123
            secret/db-secret created

            controlplane ~ ‚ûú  k get secrets 
            NAME              TYPE                                  DATA   AGE
            dashboard-token   kubernetes.io/service-account-token   3      25m
            db-secret         Opaque                                3      8s
                

        Declarative way:
            
            vim db-secret.yaml
            
            apiVersion: v1
            kind: Secret
            metadata:
                name: db-secret
                type: Opaque
            data:
                DB_Host: c3FsMDE=
                DB_User: cm9vdA==
                DB_Password: cGFzc3dvcmQxMjM=


            controlplane ~ ‚ûú  k delete secrets db-secret 
            secret "db-secret" deleted

            controlplane ~ ‚ûú  k apply -f db-secret.yaml 
            Error from server (BadRequest): error when creating "db-secret.yaml": Secret in version "v1" cannot be handled as a Secret: illegal base64 data at input byte 4

        **WARNING:** Since Secret's data field requires that the value be stored in Base64 encoded form. 
        Use echo -n to encode:

            controlplane ~ ‚úñ echo -n 'sql01' | base64 
            c3FsMDE=

            controlplane ~ ‚ûú  echo -n 'root' | base64
            cm9vdA==

            controlplane ~ ‚ûú  echo -n 'password123' | base64
            cGFzc3dvcmQxMjM=

            Replace the above encoded fields back into the file:
            
            apiVersion: v1
            kind: Secret
            metadata:
                name: db-secret
            type: Opaque
            data:
                DB_Host: c3FsMDE=
                DB_User: cm9vdA==
                DB_Password: cGFzc3dvcmQxMjM=

            controlplane ~ ‚ûú  k apply -f db-secret.yaml 
            secret/db-secret created

            controlplane ~ ‚ûú  k get secrets 
            NAME              TYPE                                  DATA   AGE
            dashboard-token   kubernetes.io/service-account-token   3      40m
            db-secret         Opaque      

    3) Configure webapp-pod to load environment variables from the newly created secret.
        Delete and recreate the pod if required.

        Pod name: webapp-pod
        Image name: kodekloud/simple-webapp-mysql
        Env From: Secret=db-secret

            k get pod webapp-pod -o yaml > webap-pod.yaml

        controlplane ~ ‚ûú  k get pod webapp-pod -o yaml > webap-pod.yaml

            spec:
            containers:
            - image: kodekloud/simple-webapp-mysql
                imagePullPolicy: Always
                name: webapp
                envFrom:
                - secretRef:
                    name: db-secret


        controlplane ~ ‚ûú  k delete pod webapp-pod 
        pod "webapp-pod" deleted

        controlplane ~ ‚ûú  k apply -f webapp-pod.yaml 
        pod/webapp-pod created

        controlplane ~ ‚úñ k get pods
        NAME         READY   STATUS    RESTARTS   AGE
        mysql        1/1     Running   0          48m
        webapp-pod   1/1     Running   0          2m4s

        View the web application to verify it can successfully connect to the database
        (Connect to the db sucessfully, Shown below:)
        ![Sucess Display](images/Secrets03.png "Secrets Image")










5. Docker Security & Security Accounts  


6. Security  Acconts



7. Resource Requirements    


8. Taints and  Tolerations  


9.  Node Selectors & Affinity   


10. Taints & Tolerations vs. Node Affinity


